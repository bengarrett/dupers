# https://taskfile.dev

# This Task file uses relative paths and expects to be located in the root of the dupers repository.
version: '3'

vars:
  FILE: ./test/files_to_check/qziD6WMRvPyk
  ABSDST: "{{.USER_WORKING_DIR}}/.task"
  DST: ./.task/
  TEST: ./test/
  TMP: ./test/randomfiles.*
  CHK: ./test/files_to_check/*
  B1: ./test/bucket1/*
  B2: ./test/bucket2/*

tasks:
  race:
    silent: true
    cmds:
      - go build -v -race -o dupers main.go
  errs:
    silent: true
    cmds:
      - echo -e "## Testing failures"
      - go run -race main.go invalid-command
      - go run -race main.go invalid-command and-more-args
  flags:
    silent: true
    cmds:
      - echo -e "## Testing help.\n"
      - go run -race main.go
      - echo -e "## Testing -mono.\n"
      - go run -race main.go -mono
      - echo -e "## Testing database help"
      - go run -race main.go -h database
      - echo -e "## Testing search help"
      - go run -race main.go search --help
      - echo -e "## Testing dupe help"
      - go run -race main.go -help dupe
      - echo -e "## Testing -version.\n"
      - go run -race main.go -version
      - echo -e "## Testing -mono -version.\n"
      - go run -race main.go -mono -version      
      - echo -e "## Testing -mono -version -quiet.\n"
      - go run -race main.go -mono -version -quiet
      - echo -e "## Testing -mvq.\n"
      - go run -race main.go -m -v -q
      - echo -e "## Database"
      - go run -race main.go database
      - echo -e "## DB -d -m"
      - go run -race main.go db -d -m
      - echo -e "## Debug aliases"
      - go run -race main.go -m -q -d -v -h -e -n -f
      - echo -e "## Debug flag"
      - go run -race main.go -mono -quiet -debug -version -help -exact -name -fast -delete -delete+ -sensen
  makeTmp:
    silent: false
    cmds:
      - cmd:
          mkdir --verbose {{.DST}}
        ignore_error: true
      - cmd:
          cp --no-clobber --no-dereference {{.CHK}} {{.DST}}
          cp --no-clobber --no-dereference {{.TMP}} {{.DST}}
          cp --no-clobber --no-dereference {{.B1}} {{.DST}}
          cp --no-clobber --no-dereference {{.B2}} {{.DST}}
        ignore_error: true
  removeTmp:
    silent: false
    cmds:
      - cmd:
         rm --force --recursive --verbose {{.DST}}
        ignore_error: true
  dupeFile:
    silent: false
    cmds:
      - cmd:
         go run -race main.go dupe {{.FILE}} {{.DST}}
      - cmd:
         go run -race main.go -fast dupe {{.FILE}} {{.DST}}
  dupeClone:
    silent: false
    cmds:
      - cmd:
         go run -race main.go -yes dupe {{.TEST}} {{.ABSDST}}
        ignore_error: true
      - cmd:
         go run -race main.go -yes -fast dupe {{.TEST}} {{.ABSDST}}/
        ignore_error: true
      - cmd:
         go run -race main.go -yes dupe {{.TEST}} {{.DST}}
        ignore_error: true
      - cmd:
         go run -race main.go dupe {{.TEST}}xx {{.DST}}
        ignore_error: true
      - cmd:
         go run -race main.go -fast dupe xx{{.TEST}} {{.DST}}
        ignore_error: true
      # todo multiple buckets
      # mixed valid and broken buckets
      # create a -yes global flag
  one:
    silent: false
    cmds:
      - task: makeTmp
      - task: dupeFile
      - task: dupeClone
      #- task: removeTmp
  
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 